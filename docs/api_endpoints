Documenta√ß√£o da API - LaMusic Micro Importer
Vers√£o: 1.0 URL Base: http://localhost:3002/api/v1

Autentica√ß√£o
A maioria dos endpoints desta API √© protegida e requer um token de autentica√ß√£o.

Obtenha o Token: Fa√ßa uma requisi√ß√£o para o endpoint POST /auth/login com suas credenciais para receber um accessToken.
Envie o Token: Para todos os endpoints protegidos, inclua o token no header Authorization da sua requisi√ß√£o.
Header: Authorization
Valor: Bearer <seu_accessToken>
1. M√≥dulo de Autentica√ß√£o (/auth)
Endpoints para gerenciar a autentica√ß√£o de usu√°rios.

1.1 Login de Usu√°rio
Endpoint: POST /auth/login
Descri√ß√£o: Autentica um usu√°rio com base em email e senha e retorna um token JWT para ser usado em requisi√ß√µes subsequentes.
Autentica√ß√£o: P√∫blica.

Request Body
Campo	Tipo	Obrigat√≥rio	Descri√ß√£o
email	string	Sim	Email de cadastro do usu√°rio.
password	string	Sim	Senha do usu√°rio (m√≠nimo 6 caracteres).

Exemplo de Requisi√ß√£o (Postman)
M√©todo: POST
URL: {{baseURL}}/auth/login
Headers: Content-Type: application/json
Body (raw, JSON):
{
  "email": "vitor@gmail.com",
  "password": "sua_senha_aqui"
}

Respostas
200 OK (Sucesso):
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IlVzdcOhcmlvIFRlc3RlIFBvc3RtYW4iLCJzdWIiOiIwOWIyNjk2Ny0zZGQ2LTRkMzEtOTA4OC01NWMxOGZlNTk4MjYiLCJpYXQiOjE3MTk0NTYwMDAsImV4cCI6MTcxOTU0MjQwMH0.abcdef123456"
}

401 Unauthorized (Falha): Retornado se as credenciais forem inv√°lidas.
{
  "message": "Credenciais inv√°lidas.",
  "error": "Unauthorized",
  "statusCode": 401
}

2. M√≥dulo de Produtos (/products)
Endpoints para o gerenciamento completo do cat√°logo de produtos.

Autentica√ß√£o: Todos os endpoints deste m√≥dulo requerem Bearer Token.

### 2.1 Criar um Produto
Endpoint: `POST /products`
Descri√ß√£o: Cria um novo produto no cat√°logo. Requer permiss√£o de administrador.

**Request Body (`CreateProductDto`)**
| Campo | Tipo | Obrigat√≥rio | Descri√ß√£o |
| :--- | :--- | :--- | :--- |
| `name` | string | Sim | Nome do produto. |
| `price` | number | Sim | Pre√ßo de venda do produto. |
| `stockQuantity` | number | Sim | Quantidade inicial em estoque. |
| `description` | string | N√£o | Descri√ß√£o detalhada do produto. |
| `sku` | string | N√£o | C√≥digo de refer√™ncia √∫nico (SKU). Se fornecido, deve ser √∫nico. |
| `featured` | boolean | N√£o | Indica se o produto est√° em destaque (default: `false`). |
| `status` | string | N√£o | Status do produto. Aceita 'ACTIVE' ou 'INACTIVE' (default: 'ACTIVE'). |
| `categoryIds` | string[] | N√£o | Array de UUIDs das categorias a serem associadas. |

**Exemplo de Requisi√ß√£o (Postman)**
M√©todo: `POST`
URL: `{{baseURL}}/products`
Authorization: `Bearer <token>`
Body (raw, JSON):
```json
{
  "name": "Microfone Condensador Pro-Sound X1",
  "description": "Microfone de est√∫dio profissional para grava√ß√µes de alta qualidade.",
  "price": 899.90,
  "stockQuantity": 25,
  "sku": "MIC-PS-X1-COND",
  "featured": true,
  "status": "ACTIVE",
  "categoryIds": ["uuid-da-categoria-de-microfones"]
}
```

**Respostas**
- **201 Created (Sucesso):** Retorna o objeto do produto rec√©m-criado.
- **400 Bad Request (Falha de Valida√ß√£o):** Retornado se algum campo obrigat√≥rio estiver faltando ou se os tipos de dados estiverem incorretos.
- **409 Conflict (Conflito):** Retornado se o `sku` enviado j√° existir no banco de dados.


### 2.2 Listar Todos os Produtos
Endpoint: `GET /products`
Descri√ß√£o: Retorna uma lista paginada de todos os produtos. Este endpoint segue o **padr√£o de objeto paginado**.
Query Parameters:
- `page` (number, opcional, default: 1): O n√∫mero da p√°gina a ser retornada.
- `limit` (number, opcional, default: 10): O n√∫mero de itens por p√°gina.
- `search` (string, opcional): Termo para buscar no nome ou SKU do produto (case-insensitive).

Exemplo de Requisi√ß√£o (Postman)
M√©todo: GET
URL: `{{baseURL}}/products?page=1&limit=10&search=guitarra`
Authorization: Bearer <token>

**Estrutura da Resposta (Objeto Paginado)**
200 OK (Sucesso): Retorna um objeto contendo os dados e os metadados de pagina√ß√£o.
```json
{
  "data": [
    {
      "id": "uuid-do-produto",
      "name": "Guitarra El√©trica",
      "sku": "GTR-001",
      "price": 1500.00
      // ... outros campos do produto
    }
  ],
  "total": 25,
  "page": 1,
  "limit": 10
}
```

### 2.3 Listar Produtos com Estat√≠sticas de Vendas
Endpoint: `GET /products/with-sales`
Descri√ß√£o: Retorna uma lista paginada de produtos com todos os dados necess√°rios para a listagem do admin, incluindo estat√≠sticas de vendas. Devido √† complexidade da consulta, este endpoint segue o **padr√£o de array plano**.
Query Parameters:
- `page` (number, opcional, default: 1): O n√∫mero da p√°gina.
- `limit` (number, opcional, default: 10): O n√∫mero de itens por p√°gina.
- `search` (string, opcional): Termo para buscar no nome ou SKU do produto (case-insensitive).

Exemplo de Requisi√ß√£o (Postman)
M√©todo: GET
URL: `{{baseURL}}/products/with-sales?search=harmony`
Authorization: Bearer <token>

**Estrutura da Resposta (Array Plano)**
200 OK (Sucesso): Retorna um array de objetos, onde cada objeto √© um produto enriquecido com dados de vendas e pagina√ß√£o.
```json
[
  {
    "id": "uuid-do-produto",
    "name": "Guitarra El√©trica Stratocaster Harmony",
    "description": "A cl√°ssica guitarra Stratocaster da Harmony, perfeita para rock e blues.",
    "sku": "GTR-ELE-002",
    "price": "850.00",
    "stock_quantity": 15,
    "status": "active",
    "featured": true,
    "category_name": "Instrumentos de Corda",
    "created_at": "2025-06-27T10:00:00.000Z",
    "completed_orders_count": "25",
    "pending_orders_count": "2",
    "total_count": "39"
  }
]
```

**Nota sobre a Estrutura e o campo `total_count`**:
- **Estrutura de Array Plano**: A resposta √© um array direto para otimizar a performance da consulta complexa no banco de dados.
- **`total_count`**: Este campo **n√£o √© a soma das vendas**. Ele representa o **n√∫mero total de produtos que correspondem aos crit√©rios de busca** e √© usado para construir a pagina√ß√£o no frontend. Ele ter√° o mesmo valor para todos os itens retornados em uma √∫nica requisi√ß√£o.

-- D√©bito t√©cnico: responsabilidade do backend entregar a resposta pronta e no formato ideal

### 2.4 Buscar Produto por ID
Endpoint: `GET /products/:id`
Descri√ß√£o: Busca e retorna um √∫nico produto pelo seu UUID.

Exemplo de Requisi√ß√£o (Postman)
M√©todo: GET
URL: `{{baseURL}}/products/f82b7130-6a34-4c61-a1e3-74a789e033a7`
Authorization: Bearer <token>

Respostas
200 OK (Sucesso): Retorna o objeto do produto.
404 Not Found (Falha): Se o produto n√£o for encontrado.

### 2.5 Atualizar um Produto
Endpoint: PATCH /products/:id
Descri√ß√£o: Atualiza parcialmente os dados de um produto existente.
Request Body (UpdateProductDto)
Aceita qualquer campo do CreateProductDto, todos s√£o opcionais.

Exemplo de Requisi√ß√£o (Postman)
M√©todo: PATCH
URL: {{baseURL}}/products/f82b7130-6a34-4c61-a1e3-74a789e033a7
Authorization: Bearer <token>
Body (raw, JSON):
{
  "price": 849.99,
  "featured": false
}

Respostas
200 OK (Sucesso): Retorna o objeto do produto completo ap√≥s a atualiza√ß√£o.
404 Not Found (Falha): Se o produto a ser atualizado n√£o for encontrado.

### 2.6 Deletar um Produto (Soft Delete)
Endpoint: DELETE /products/:id
Descri√ß√£o: Realiza um "soft delete" no produto, preenchendo o campo deleted_at.
Exemplo de Requisi√ß√£o (Postman)
M√©todo: DELETE
URL: {{baseURL}}/products/f82b7130-6a34-4c61-a1e3-74a789e033a7
Authorization: Bearer <token>
Respostas
200 OK (Sucesso): Retorna uma confirma√ß√£o.
404 Not Found (Falha): Se o produto a ser deletado n√£o for encontrado.


3. M√≥dulo de Categorias (/categories)
Endpoints para o gerenciamento de categorias de produtos.

Autentica√ß√£o: Todos os endpoints deste m√≥dulo requerem Bearer Token.

### 3.1 Listar Todas as Categorias
Endpoint: `GET /categories`
Descri√ß√£o: Retorna uma lista com todas as categorias de produtos ativas no sistema. √ötil para preencher seletores no formul√°rio de cria√ß√£o/edi√ß√£o de produtos.

**Exemplo de Requisi√ß√£o (Postman)**
M√©todo: `GET`
URL: `{{baseURL}}/categories`
Authorization: `Bearer <token>`

**Estrutura da Resposta**
200 OK (Sucesso): Retorna um array de objetos de categoria.
```json
[
  {
    "id": "uuid-da-categoria-1",
    "name": "Instrumentos de Corda",
    "slug": "instrumentos-de-corda",
    "description": "Viol√µes, guitarras, baixos, etc.",
    "parentId": null,
    "isActive": true
  },
  {
    "id": "uuid-da-categoria-2",
    "name": "Equipamentos de √Åudio",
    "slug": "equipamentos-de-audio",
    "description": "Microfones, mixers, amplificadores, etc.",
    "parentId": null,
    "isActive": true
  }
]
```


4. M√≥dulo de Importa√ß√£o (/import)
Endpoints para processos de importa√ß√£o de dados.

4.1 Processar NF-e
Endpoint: POST /import/nfe
Descri√ß√£o: Recebe o conte√∫do XML de uma NF-e, valida, extrai os dados do fornecedor e dos produtos, e os cadastra ou atualiza no sistema.
Autentica√ß√£o: Requer Bearer Token.
Request Body
Campo	Tipo	Obrigat√≥rio	Descri√ß√£o
nfeXmlContent	string	Sim	Conte√∫do completo do arquivo XML da NF-e.
Exemplo de Requisi√ß√£o (Postman)
M√©todo: POST
URL: {{baseURL}}/import/nfe
Authorization: Bearer <token>
Body (raw, JSON):
{
  "nfeXmlContent": "<?xml version=\"1.0\" encoding=\"UTF-8\"?><nfeProc ... </nfeProc>"
}

Respostas
201 Created (Sucesso): Retorna um resumo da opera√ß√£o.
{
  "message": "NFE processed successfully.",
  "supplier": { /* objeto do fornecedor */ },
  "processedProductsCount": 5,
  "processedProducts": [ /* array de produtos criados/atualizados */ ]
}
400 Bad Request (Falha): Se a IA considerar o conte√∫do da NF-e inv√°lido.


5. M√≥dulo de IA (/ai)
Endpoints de utilidade para acessar diretamente as funcionalidades de IA.

5.1 Status do Servi√ßo de IA
Endpoint: GET /ai/status
Descri√ß√£o: Verifica o status operacional do servi√ßo de IA.
Autentica√ß√£o: P√∫blica.
5.2 Categorizar um Produto
Endpoint: POST /ai/categorize-product
Descri√ß√£o: Sugere uma categoria para um produto com base em seus dados.
Autentica√ß√£o: P√∫blica.
Request Body
Campo	Tipo	Obrigat√≥rio
name	string	Sim
description	string	N√£o
brand	string	N√£o
sku	string	N√£o
Exemplo de Requisi√ß√£o (Postman)
M√©todo: POST
URL: {{baseURL}}/ai/categorize-product
Body (raw, JSON):
{
    "name": "Bateria Ac√∫stica PowerDrum 5 Pe√ßas",
    "description": "Kit de bateria completo com bumbo, tons, surdo e caixa. Ideal para iniciantes.",
    "brand": "PowerDrum"
}

Respostas
201 Created (Sucesso): Retorna um objeto AiResponse com a categoria sugerida.
{
    "success": true,
    "data": "Instrumentos de Percuss√£o",
    "processingTime": 1234,
    "tokensUsed": 50
}

# 6. M√≥dulo de Pedidos (/orders)
Endpoints para gerenciamento e an√°lise de pedidos.

**Autentica√ß√£o:** Todos os endpoints deste m√≥dulo requerem Bearer Token.

## 6.1 Relat√≥rio de Pedidos (MELHORADO)
**Endpoint:** `GET /orders/report`  
**Descri√ß√£o:** Retorna um relat√≥rio completo de pedidos com m√©tricas agregadas e dados para an√°lise administrativa. Inclui filtros avan√ßados por per√≠odo, status e busca granular.

### **Query Parameters**
| Par√¢metro | Tipo | Obrigat√≥rio | Descri√ß√£o |
| :--- | :--- | :--- | :--- |
| `startDate` | string (Date/ISO8601) | N√£o | Data inicial do per√≠odo. Aceita formato YYYY-MM-DD ou ISO8601 completo |
| `endDate` | string (Date/ISO8601) | N√£o | Data final do per√≠odo. Aceita formato YYYY-MM-DD ou ISO8601 completo |
| `status` | string | N√£o | **NOVO:** Filtrar por status espec√≠fico (pending, processing, shipped, delivered, cancelled, confirmed, completed) |
| `orderNumber` | string | N√£o | **NOVO:** Filtrar especificamente por n√∫mero do pedido (busca parcial) |
| `customerName` | string | N√£o | **NOVO:** Filtrar especificamente por nome do cliente (busca parcial) |
| `search` | string | N√£o | Busca geral (n√∫mero do pedido, nome ou email do cliente). N√£o funciona junto com filtros espec√≠ficos |
| `page` | number | N√£o | N√∫mero da p√°gina (default: 1) |
| `limit` | number | N√£o | Itens por p√°gina (default: 20, m√°x: 100) |

### **Exemplos de Requisi√ß√£o (Postman)**

**1. Filtro por Status:**
```
GET {{baseURL}}/orders/report?status=delivered&page=1&limit=10
```

**2. Filtro por Per√≠odo:**
```
GET {{baseURL}}/orders/report?startDate=2025-06-01&endDate=2025-06-30
```

**3. Filtro por N√∫mero do Pedido:**
```
GET {{baseURL}}/orders/report?orderNumber=ORD-2025&page=1&limit=10
```

**4. Filtro por Nome do Cliente:**
```
GET {{baseURL}}/orders/report?customerName=jo√£o silva&page=1&limit=10
```

**5. Filtros Combinados:**
```
GET {{baseURL}}/orders/report?status=pending&customerName=maria&startDate=2025-06-01T00:00:00Z&endDate=2025-06-30T23:59:59Z
```

**6. Busca Geral:**
```
GET {{baseURL}}/orders/report?search=silva&page=1&limit=10
```

### **Estrutura da Resposta**
**200 OK (Sucesso):** Retorna dados paginados com m√©tricas agregadas.

```json
{
  "orders": [
    {
      "id": "uuid-do-pedido",
      "orderNumber": "ORD-2025-001",
      "status": "delivered",
      "customerName": "Jo√£o Silva",
      "customerEmail": "joao@email.com",
      "itemsCount": 3,
      "totalAmount": 1299.90,
      "shippingCity": "S√£o Paulo",
      "shippingState": "SP",
      "hasCoupon": true,
      "couponCode": "DESCONTO10",
      "hasInactiveProducts": false,
      "hasPaymentPending": false,
      "approximateMargin": 389.97,
      "createdAt": "2025-06-27T10:00:00.000Z",
      "totalCount": 150
    }
  ],
  "summary": {
    "totalOrders": 150,
    "totalSales": 25890.50,
    "averageOrderValue": 172.60,
    "totalMargin": 7767.15
  }
}
```

### **Campos Detalhados da Resposta**

#### **Objeto Order (dentro do array orders):**
| Campo | Tipo | Descri√ß√£o |
| :--- | :--- | :--- |
| `id` | UUID | Identificador √∫nico do pedido |
| `orderNumber` | string | N√∫mero do pedido (ex: ORD-2025-001) |
| `status` | string | Status atual (lowercase: pending, delivered, etc.) |
| `customerName` | string | Nome completo do cliente |
| `customerEmail` | string | Email do cliente |
| `itemsCount` | number | Quantidade total de itens no pedido |
| `totalAmount` | number | Valor total do pedido |
| `shippingCity` | string | Cidade de entrega |
| `shippingState` | string | Estado de entrega |
| `hasCoupon` | boolean | Se o pedido utilizou cupom de desconto |
| `couponCode` | string\|null | C√≥digo do cupom utilizado |
| `hasInactiveProducts` | boolean | **üö® ALERTA:** Se cont√©m produtos descontinuados |
| `hasPaymentPending` | boolean | **‚ö†Ô∏è ALERTA:** Se h√° pagamento pendente |
| `approximateMargin` | number | Margem de lucro aproximada |
| `createdAt` | ISO8601 | Data/hora de cria√ß√£o do pedido |
| `totalCount` | number | Total de registros (para pagina√ß√£o) |

#### **Objeto Summary:**
| Campo | Tipo | Descri√ß√£o |
| :--- | :--- | :--- |
| `totalOrders` | number | Total de pedidos no per√≠odo filtrado |
| `totalSales` | number | Soma total das vendas |
| `averageOrderValue` | number | Ticket m√©dio (calculado automaticamente) |
| `totalMargin` | number | Margem total de lucro |

### **Notas Importantes:**
- **Filtros Espec√≠ficos:** `orderNumber`, `customerName`, `status` podem ser combinados
- **Busca Geral:** `search` s√≥ funciona quando filtros espec√≠ficos n√£o s√£o usados
- **Case-insensitive:** Todos os filtros de texto s√£o insens√≠veis a mai√∫sculas/min√∫sculas
- **Partial Match:** Filtros de texto usam correspond√™ncia parcial
- **Formato de Data:** Aceita tanto YYYY-MM-DD quanto ISO8601 completo

